(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{1713:(e,a,r)=>{Promise.resolve().then(r.bind(r,2290))},2290:(e,a,r)=>{"use strict";r.d(a,{default:()=>m});var t=r(5155),n=r(2115),s=r(8173),l=r.n(s);let i=e=>{if(!e||e.length<4)return"****";let a=e.slice(-4);return`**** **** **** ${a}`};var o=r(2628);r(4401),r(9995);let d=[{id:"payoneer",name:"Payoneer",icon:"\uD83D\uDCB3",recommendedFor:["US","EU","UK"],priority:90,availableIn:["US","EU","UK","Africa"]},{id:"bank-transfer",name:"Bank Transfer",icon:"\uD83C\uDFE6",recommendedFor:["Kenya"],priority:80,availableIn:["Global"]},{id:"mpesa",name:"M-Pesa",icon:"\uD83D\uDCF1",recommendedFor:["Kenya"],priority:95,availableIn:["Kenya","Tanzania","Ghana"]},{id:"credit-card",name:"Credit Card",icon:"\uD83D\uDCB3",recommendedFor:["Global"],priority:70,availableIn:["Global"]},{id:"paypal",name:"PayPal",icon:"\uD83D\uDD10",recommendedFor:["US","EU","UK"],priority:75,availableIn:["Global","except restricted countries"]},{id:"wise",name:"Wise",icon:"\uD83C\uDF10",recommendedFor:["UK","EU"],priority:85,availableIn:["Global"]},{id:"western-union",name:"Western Union",icon:"\uD83C\uDFDB️",recommendedFor:[],priority:50,availableIn:["Global"]},{id:"crypto",name:"Cryptocurrency",icon:"₿",recommendedFor:[],priority:40,availableIn:["Global"]}];function m(){let{user:e,isAuthenticated:a}=(0,o.A)(),[r,s]=(0,n.useState)(""),[m,c]=(0,n.useState)([]),[u,x]=(0,n.useState)(""),[h,p]=(0,n.useState)(""),[b,y]=(0,n.useState)({cardNumber:"",expiryDate:"",cvv:"",name:"",amount:0,currency:"USD",paymentMethod:""}),[g,f]=(0,n.useState)(""),[j,N]=(0,n.useState)(""),[v,w]=(0,n.useState)(""),[S,C]=(0,n.useState)(!1),[E,F]=(0,n.useState)(!1),[k,P]=(0,n.useState)(""),[U,T]=(0,n.useState)("");(0,n.useEffect)(()=>{if(!a)return;let r=e?.region||"Kenya";x(r);let t=[...d.filter(e=>!!(e.availableIn.includes("Global")||e.availableIn.includes(r)))].sort((e,a)=>{let t=e.recommendedFor.includes(r),n=a.recommendedFor.includes(r);return t&&!n?-1:!t&&n?1:a.priority-e.priority});if(c(t),e?.defaultPaymentMethod){let a=t.find(a=>a.id===e.defaultPaymentMethod);a?(s(a.id),y(e=>({...e,paymentMethod:a.id}))):(s(t[0]?.id||""),y(e=>({...e,paymentMethod:t[0]?.id||""})))}else s(t[0]?.id||""),y(e=>({...e,paymentMethod:t[0]?.id||""}));let n=`secure-token-${Math.random().toString(36).substring(2)}`;p(n),document.cookie=`csrf_token=${n}; path=/; secure; samesite=strict`},[a,e]);let D=e=>{s(e),y(a=>({...a,paymentMethod:e})),N("")},A=e=>{let{name:a,value:r,type:t}=e.target;"cardNumber"===a&&f(i(r)),y({...b,[a]:"number"===t?parseFloat(r):r})},I=async e=>{e.preventDefault(),N(""),w(""),C(!0);try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required. Please login.");let a=await fetch("/api/payment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`,"X-CSRF-Token":h},body:JSON.stringify({...b,amount:parseFloat(b.amount.toString())})}),t=await a.json();if(t.requiresVerification){T(t.transactionId),F(!0),C(!1);return}C(!1),w(`Payment successful! Confirmation code: ${t.confirmationCode}`),y({cardNumber:"",expiryDate:"",cvv:"",name:"",amount:0,currency:"USD",paymentMethod:r}),f("")}catch(e){C(!1),N(e instanceof Error?e.message:"Payment failed. Please try a different method or try again later.")}},q=async()=>{N(""),C(!0);try{let e=localStorage.getItem("token");if(!e)throw Error("Authentication required. Please login.");let a=await fetch("/api/auth/two-factor",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({token:k,transactionId:U})}),t=await a.json();if(!a.ok)throw Error(t.error||"Verification failed");let n=await fetch("/api/payment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`,"X-CSRF-Token":h},body:JSON.stringify({...b,amount:parseFloat(b.amount.toString()),twoFactorVerified:!0})}),s=await n.json();F(!1),P(""),T(""),C(!1),w(`Payment successful! Confirmation code: ${s.confirmationCode}`),y({cardNumber:"",expiryDate:"",cvv:"",name:"",amount:0,currency:"USD",paymentMethod:r}),f("")}catch(e){C(!1),N(e instanceof Error?e.message:"Verification failed. Please try again.")}};return a?(0,t.jsxs)("div",{className:"max-w-3xl mx-auto",children:[v&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-green-50 text-green-800 border border-green-200 rounded-md",children:(0,t.jsxs)("div",{className:"flex items-start",children:[(0,t.jsx)("span",{className:"text-green-600 text-xl mr-2",children:"✓"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:v}),(0,t.jsx)("p",{className:"text-sm mt-1",children:"Thank you for your payment! A receipt has been sent to your email."})]})]})}),(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Select Payment Method"}),(0,t.jsx)("div",{className:"flex overflow-x-auto gap-2 pb-2",children:m.map(e=>(0,t.jsxs)("button",{onClick:()=>D(e.id),className:`flex items-center px-4 py-3 rounded-lg min-w-[140px] border transition
                ${r===e.id?"bg-blue-50 border-blue-500 text-blue-700":"bg-white border-gray-200 hover:bg-gray-50"}
                ${e.recommendedFor.includes(u)?"ring-2 ring-blue-200":""}
              `,children:[(0,t.jsx)("span",{className:"mr-2 text-xl",children:e.icon}),(0,t.jsx)("span",{children:e.name}),e.recommendedFor.includes(u)&&(0,t.jsx)("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-1.5 py-0.5 rounded-full",children:"Recommended"})]},e.id))})]}),(0,t.jsxs)("form",{onSubmit:I,className:"bg-white p-6 rounded-lg shadow-md border border-gray-200",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("h3",{className:"text-lg font-medium mb-4",children:[m.find(e=>e.id===r)?.name||"Payment"," Details"]}),(0,t.jsx)("input",{type:"hidden",name:"csrfToken",value:h}),"credit-card"===r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"cardNumber",className:"block text-sm font-medium text-gray-700 mb-1",children:"Card Number"}),(0,t.jsx)("input",{type:"text",id:"cardNumber",name:"cardNumber",onChange:A,placeholder:"**** **** **** ****",className:"w-full p-2 border border-gray-300 rounded-md",maxLength:19,required:!0}),g&&(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["For your security, we store this as: ",g]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"expiryDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Date"}),(0,t.jsx)("input",{type:"text",id:"expiryDate",name:"expiryDate",onChange:A,placeholder:"MM/YY",className:"w-full p-2 border border-gray-300 rounded-md",maxLength:5,required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"cvv",className:"block text-sm font-medium text-gray-700 mb-1",children:"CVV"}),(0,t.jsx)("input",{type:"text",id:"cvv",name:"cvv",onChange:A,placeholder:"***",className:"w-full p-2 border border-gray-300 rounded-md",maxLength:4,required:!0})]})]})]}),"bank-transfer"===r&&(0,t.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded-md",children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"Bank Account Details (Kenya)"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Account Name: Your Company Ltd"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Bank: ABC Bank Kenya"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Account Number: XXXX-XXXX-XXXX"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"SWIFT/BIC: ABCKENXXX"})]}),"payoneer"===r&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Optimized for US and European users sending money to Kenya. Lower fees and faster processing times than traditional bank transfers."}),(0,t.jsx)("label",{htmlFor:"payoneerEmail",className:"block text-sm font-medium text-gray-700 mb-1",children:"Payoneer Email"}),(0,t.jsx)("input",{type:"email",id:"payoneerEmail",name:"payoneerEmail",onChange:A,placeholder:"your@email.com",className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),"mpesa"===r&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"mpesaNumber",className:"block text-sm font-medium text-gray-700 mb-1",children:"M-Pesa Phone Number"}),(0,t.jsx)("input",{type:"tel",id:"mpesaNumber",name:"mpesaNumber",onChange:A,placeholder:"e.g. 254712345678",className:"w-full p-2 border border-gray-300 rounded-md",required:!0}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Format: 254 followed by your 9-digit phone number"})]}),"paypal"===r&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"paypalEmail",className:"block text-sm font-medium text-gray-700 mb-1",children:"PayPal Email"}),(0,t.jsx)("input",{type:"email",id:"paypalEmail",name:"paypalEmail",onChange:A,placeholder:"your@email.com",className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),"wise"===r&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Wise (formerly TransferWise) offers competitive exchange rates and low fees for international transfers."}),(0,t.jsx)("label",{htmlFor:"wiseEmail",className:"block text-sm font-medium text-gray-700 mb-1",children:"Wise Email"}),(0,t.jsx)("input",{type:"email",id:"wiseEmail",name:"wiseEmail",onChange:A,placeholder:"your@email.com",className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),"western-union"===r&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Send money for cash pickup at thousands of agent locations worldwide."}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"recipientFirstName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Recipient First Name"}),(0,t.jsx)("input",{type:"text",id:"recipientFirstName",name:"recipientFirstName",onChange:A,className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"recipientLastName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Recipient Last Name"}),(0,t.jsx)("input",{type:"text",id:"recipientLastName",name:"recipientLastName",onChange:A,className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]})]})]}),"crypto"===r&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Send cryptocurrency payments with low fees and fast confirmation times."}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"cryptoType",className:"block text-sm font-medium text-gray-700 mb-1",children:"Cryptocurrency"}),(0,t.jsxs)("select",{id:"cryptoType",name:"cryptoType",onChange:A,className:"w-full p-2 border border-gray-300 rounded-md",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select cryptocurrency"}),(0,t.jsx)("option",{value:"BTC",children:"Bitcoin (BTC)"}),(0,t.jsx)("option",{value:"ETH",children:"Ethereum (ETH)"}),(0,t.jsx)("option",{value:"USDT",children:"Tether (USDT)"}),(0,t.jsx)("option",{value:"USDC",children:"USD Coin (USDC)"})]})]}),(0,t.jsx)("label",{htmlFor:"walletAddress",className:"block text-sm font-medium text-gray-700 mb-1",children:"Wallet Address"}),(0,t.jsx)("input",{type:"text",id:"walletAddress",name:"walletAddress",onChange:A,placeholder:"Enter recipient wallet address",className:"w-full p-2 border border-gray-300 rounded-md",required:!0})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount"}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsxs)("select",{name:"currency",value:b.currency,onChange:A,className:"p-2 border border-gray-300 rounded-l-md",children:[(0,t.jsx)("option",{value:"USD",children:"USD"}),(0,t.jsx)("option",{value:"EUR",children:"EUR"}),(0,t.jsx)("option",{value:"KES",children:"KES"}),(0,t.jsx)("option",{value:"GBP",children:"GBP"})]}),(0,t.jsx)("input",{type:"number",id:"amount",name:"amount",value:b.amount||"",onChange:A,placeholder:"0.00",className:"w-full p-2 border border-gray-300 rounded-r-md",min:"0.01",step:"0.01",required:!0})]}),b.amount>0&&e&&function(e,a,r){if(r)return!0;let t={USD:1e3,EUR:900,GBP:800,KES:1e5,DEFAULT:1e3};return e>=(t[a]||t.DEFAULT)}(b.amount,b.currency,e.twoFactorEnabled)&&(0,t.jsxs)("p",{className:"mt-2 text-xs text-orange-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Note:"})," This high-value transaction will require two-factor authentication."]})]})]}),(0,t.jsx)(()=>(0,t.jsxs)("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-md",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("span",{className:"text-green-600 text-xl",children:"\uD83D\uDD12"}),(0,t.jsx)("h3",{className:"text-green-800 font-medium",children:"Secured Payment"})]}),(0,t.jsxs)("ul",{className:"text-sm text-green-700",children:[(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"✓"}),(0,t.jsx)("span",{children:"End-to-end encrypted payment information"})]}),(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"✓"}),(0,t.jsx)("span",{children:"Anti-phishing protection"})]}),(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"✓"}),(0,t.jsx)("span",{children:"Real-time fraud monitoring"})]}),e?.twoFactorEnabled&&(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"✓"}),(0,t.jsx)("span",{children:"Two-factor authentication enabled"})]})]})]}),{}),j&&(0,t.jsx)("div",{className:"mt-4 p-3 bg-red-50 text-red-700 border border-red-200 rounded-md",children:j}),(0,t.jsxs)("div",{className:"mt-6 flex justify-between items-center",children:[(0,t.jsx)(l(),{href:"/",className:"text-blue-600 hover:text-blue-800",children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:S||!r||b.amount<=0,className:`px-6 py-2 rounded-md ${S||!r||b.amount<=0?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:S?"Processing...":"Pay Now"})]})]}),E&&(0,t.jsx)(()=>(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md max-w-md w-full",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Verification Required"}),(0,t.jsx)("p",{className:"mb-4 text-gray-600",children:"This transaction requires additional verification for your security. Please enter the 6-digit code from your authenticator app."}),j&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-red-50 text-red-700 border border-red-200 rounded-md",children:j}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"twoFactorCode",className:"block text-sm font-medium text-gray-700 mb-1",children:"Verification Code"}),(0,t.jsx)("input",{type:"text",id:"twoFactorCode",name:"twoFactorCode",value:k,onChange:e=>P(e.target.value),placeholder:"Enter 6-digit code",className:"w-full p-2 border border-gray-300 rounded-md",maxLength:6,inputMode:"numeric",autoComplete:"one-time-code",required:!0})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{F(!1),P("")},className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),(0,t.jsx)("button",{type:"button",onClick:q,disabled:S||6!==k.length,className:`px-4 py-2 rounded-md ${S||6!==k.length?"bg-blue-300 text-white cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:S?"Verifying...":"Verify"})]})]})}),{})]}):(0,t.jsx)("div",{className:"max-w-3xl mx-auto text-center p-8",children:(0,t.jsxs)("div",{className:"bg-yellow-50 p-6 rounded-lg shadow-md border border-yellow-200",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Authentication Required"}),(0,t.jsx)("p",{className:"mb-6",children:"Please sign in to access the secure payment system."}),(0,t.jsx)(l(),{href:"/auth/login",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Sign In"})]})})}},2628:(e,a,r)=>{"use strict";r.d(a,{A:()=>o,AuthProvider:()=>i});var t=r(5155),n=r(2115),s=r(6046);let l=(0,n.createContext)({user:null,loading:!0,login:()=>{},logout:()=>{},isAuthenticated:!1});function i(e){let{children:a}=e,[r,i]=(0,n.useState)(null),[o,d]=(0,n.useState)(!0),m=(0,s.useRouter)(),c=(0,s.usePathname)();return(0,n.useEffect)(()=>{(()=>{let e=localStorage.getItem("token"),a=localStorage.getItem("user");if(e&&a)try{let e=JSON.parse(a);i(e)}catch(e){console.error("Error parsing user data:",e),localStorage.removeItem("token"),localStorage.removeItem("user")}d(!1)})()},[]),(0,n.useEffect)(()=>{!o&&(["/","/auth/login"].includes(c)||r||m.push("/auth/login"),["/admin"].includes(c)&&r?.role!=="admin"&&m.push("/payment"))},[o,r,c,m]),(0,t.jsx)(l.Provider,{value:{user:r,loading:o,login:(e,a)=>{localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(a)),i(a)},logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),i(null),m.push("/auth/login")},isAuthenticated:!!r},children:a})}function o(){return(0,n.useContext)(l)}}},e=>{var a=a=>e(e.s=a);e.O(0,[268,386,441,587,358],()=>a(1713)),_N_E=e.O()}]);