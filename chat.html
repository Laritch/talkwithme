<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Dashboard - Enhanced Chat System</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/message-search.css">
    <link rel="stylesheet" href="css/message-threading.css">
    <link rel="stylesheet" href="css/message-quoting.css">
    <link rel="stylesheet" href="css/message-sharing.css">
    <link rel="stylesheet" href="css/thread-summarizer.css">
    <link rel="stylesheet" href="css/threads-tab.css">
    <link rel="stylesheet" href="css/message-bookmarks.css">
    <link rel="stylesheet" href="css/message-labels.css">
    <link rel="stylesheet" href="css/rich-text-editor.css">
    <link rel="stylesheet" href="css/attachment-viewer.css">
    <link rel="stylesheet" href="css/typing-indicator.css">
    <link rel="stylesheet" href="css/message-scheduler.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            color: #333;
            background-color: #f5f7fb;
        }

        .container {
            display: grid;
            grid-template-columns: 280px 1fr;
            grid-template-rows: 70px 1fr;
            height: 100vh;
        }

        /* Header */
        .header {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            background-color: #667eea;
            color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .logo {
            font-size: 22px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 10px;
        }

        .user-menu {
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            background-color: #f0f0f0;
            border: 2px solid white;
        }

        .user-status {
            position: relative;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #4CAF50;
            position: absolute;
            bottom: 0;
            right: 0;
            border: 2px solid white;
        }

        .user-dropdown {
            margin-left: 20px;
            position: relative;
        }

        .dropdown-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        /* Sidebar */
        .sidebar {
            background-color: white;
            border-right: 1px solid #e1e1e1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e1e1e1;
        }

        .search-box {
            background-color: #f5f7fb;
            border-radius: 20px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
        }

        .search-box input {
            background: none;
            border: none;
            flex-grow: 1;
            margin-left: 10px;
            outline: none;
        }

        .tabs {
            display: flex;
            padding: 10px 20px;
            border-bottom: 1px solid #e1e1e1;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: #6c757d;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .conversation-list {
            flex-grow: 1;
            overflow-y: auto;
        }

        .conversation {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .conversation:hover {
            background-color: #f5f7fb;
        }

        .conversation.active {
            background-color: #e6eefd;
            border-left: 3px solid #667eea;
        }

        .conversation-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
            background-color: #f0f0f0;
            position: relative;
        }

        .conversation-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            position: absolute;
            bottom: 0;
            right: 0;
            border: 2px solid white;
        }

        .status-online {
            background-color: #4CAF50;
        }

        .status-away {
            background-color: #FFC107;
        }

        .status-busy {
            background-color: #F44336;
        }

        .status-offline {
            background-color: #9E9E9E;
        }

        .conversation-details {
            flex-grow: 1;
            overflow: hidden;
        }

        .conversation-name {
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conversation-message {
            color: #6c757d;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conversation-time {
            font-size: 12px;
            color: #6c757d;
            white-space: nowrap;
        }

        .unread-badge {
            background-color: #667eea;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 10px;
        }

        /* Chat area */
        .chat-area {
            display: flex;
            flex-direction: column;
            background-color: white;
        }

        .chat-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e1e1e1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            display: flex;
            align-items: center;
        }

        .chat-title img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
            background-color: #f0f0f0;
        }

        .chat-title-text h2 {
            margin: 0;
            font-size: 18px;
        }

        .chat-title-text p {
            margin: 0;
            color: #6c757d;
            font-size: 14px;
        }

        .chat-actions {
            display: flex;
        }

        .chat-actions button {
            background: none;
            border: none;
            font-size: 18px;
            color: #6c757d;
            margin-left: 15px;
            cursor: pointer;
        }

        .chat-messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #f5f7fb;
        }

        .message {
            margin-bottom: 20px;
            max-width: 70%;
        }

        .message.received {
            align-self: flex-start;
        }

        .message.sent {
            align-self: flex-end;
            margin-left: auto;
        }

        .message-content {
            padding: 12px 15px;
            border-radius: 10px;
            position: relative;
        }

        .message.received .message-content {
            background-color: white;
            border: 1px solid #e1e1e1;
            border-top-left-radius: 0;
        }

        .message.sent .message-content {
            background-color: #667eea;
            color: white;
            border-top-right-radius: 0;
        }

        .message-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 12px;
            color: #6c757d;
        }

        .message-time {
            margin-right: 5px;
        }

        .message-status {
            display: flex;
            align-items: center;
        }

        .message-status i {
            margin-left: 5px;
        }

        .read-status.read i {
            color: #4CAF50;
        }

        .chat-input {
            padding: 15px 20px;
            border-top: 1px solid #e1e1e1;
            display: flex;
            align-items: center;
        }

        .chat-input button {
            background: none;
            border: none;
            font-size: 18px;
            color: #6c757d;
            margin-right: 15px;
            cursor: pointer;
        }

        .chat-input input {
            flex-grow: 1;
            border: none;
            border-radius: 20px;
            padding: 12px 15px;
            background-color: #f5f7fb;
            outline: none;
        }

        .chat-input .send-btn {
            background-color: #667eea;
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 15px;
            cursor: pointer;
        }

        /* Admin Panel */
        .admin-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100vh;
            background-color: white;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
            z-index: 100;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

        .admin-panel.open {
            transform: translateX(0);
        }

        .admin-panel-header {
            padding: 20px;
            background-color: #667eea;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-panel-header h2 {
            margin: 0;
            font-size: 18px;
        }

        .admin-panel-header button {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .admin-section {
            padding: 20px;
            border-bottom: 1px solid #e1e1e1;
        }

        .admin-section h3 {
            margin-top: 0;
            color: #495057;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-card {
            background-color: #f5f7fb;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #6c757d;
        }

        .user-list {
            margin-top: 15px;
        }

        .user-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .user-item img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            background-color: #f0f0f0;
        }

        .user-item-name {
            flex-grow: 1;
            font-weight: 600;
        }

        .user-actions button {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            margin-left: 5px;
        }

        /* Welcome message display when no chat is selected */
        .welcome-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            color: #6c757d;
            padding: 20px;
        }

        .welcome-icon {
            font-size: 80px;
            color: #667eea;
            margin-bottom: 20px;
        }

        .welcome-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .welcome-subtitle {
            font-size: 16px;
            max-width: 500px;
            margin-bottom: 30px;
        }

        .welcome-features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
            max-width: 600px;
        }

        .feature-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .feature-icon {
            font-size: 30px;
            color: #667eea;
            margin-bottom: 10px;
        }

        .feature-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .feature-desc {
            font-size: 14px;
            color: #6c757d;
        }

        /* Translation Styles */
        .message-translation {
            margin-top: 8px;
            padding: 8px 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
        }

        .translation-header {
            margin-bottom: 5px;
            color: #6c757d;
        }

        .translation-text {
            font-weight: 500;
        }

        .translating {
            opacity: 0.7;
        }

        .translation-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
            color: #667eea;
            font-size: 14px;
        }

        .translation-loading i {
            margin-right: 5px;
        }

        .translate-message-btn {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            padding: 3px 5px;
        }

        .translate-message-btn:hover {
            color: #667eea;
        }

        .message-actions {
            display: flex;
            align-items: center;
            margin-top: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        /* Translation Settings Panel */
        .translation-settings {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .translation-settings h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
            color: #333;
        }

        .setting-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .setting-label {
            flex-grow: 1;
            font-weight: 500;
        }

        .language-dropdown {
            padding: 6px 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            min-width: 120px;
        }

        /* Admin Panel Enhancements */
        .admin-filters {
            margin-bottom: 15px;
        }

        .admin-select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
        }

        .admin-action-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 15px;
            background-color: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .admin-action-btn:hover {
            background-color: #5a70d8;
        }

        .loading-message {
            color: #6c757d;
            text-align: center;
            padding: 15px;
        }

        /* Settings Styles */
        .settings-list {
            margin-bottom: 15px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .setting-label {
            flex-grow: 1;
            font-weight: 500;
        }

        /* Switch Styling */
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #667eea;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #667eea;
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .slider.round {
            border-radius: 24px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* User List Enhancements */
        .user-item {
            padding: 15px 0;
        }

        .user-actions {
            display: flex;
        }

        .user-actions button {
            margin-left: 8px;
        }

        /* Content List Styles */
        .content-list {
            margin-top: 15px;
        }

        .content-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }

        .content-item:hover {
            background-color: #f5f7fb;
        }

        .content-icon {
            width: 40px;
            height: 40px;
            border-radius: 5px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 18px;
            color: #667eea;
        }

        .content-details {
            flex-grow: 1;
            overflow: hidden;
        }

        .content-text {
            font-weight: 500;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .content-meta {
            color: #6c757d;
            font-size: 12px;
            display: flex;
            align-items: center;
        }

        .content-meta-item {
            margin-right: 15px;
            display: flex;
            align-items: center;
        }

        .content-meta-item i {
            margin-right: 5px;
        }

        .content-flag {
            display: flex;
            align-items: center;
            color: #dc3545;
            font-weight: 600;
            font-size: 12px;
        }

        .content-flag i {
            margin-right: 5px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            animation: modalFadeIn 0.3s;
        }

        @keyframes modalFadeIn {
            from {transform: translateY(-50px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e1e1e1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
        }

        .modal-body {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #e1e1e1;
            display: flex;
            justify-content: flex-end;
        }

        .modal-footer button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin-left: 10px;
        }

        .submit-btn {
            background-color: #667eea;
            color: white;
        }

        .submit-btn:hover {
            background-color: #5a70d8;
        }

        .delete-btn {
            background-color: #dc3545;
            color: white;
        }

        .delete-btn:hover {
            background-color: #c82333;
        }

        .cancel-btn {
            background-color: #6c757d;
            color: white;
        }

        .cancel-btn:hover {
            background-color: #5a6268;
        }

        /* Form Styling */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="password"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
        }

        /* Content Modal Specific Styles */
        .content-details {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .content-item {
            display: flex;
            padding: 5px 0;
            border-bottom: none;
            cursor: default;
        }

        .content-item:hover {
            background-color: transparent;
        }

        .content-label {
            font-weight: 600;
            width: 120px;
        }

        .content-message {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 3px solid #667eea;
            font-size: 14px;
            line-height: 1.6;
            max-height: 200px;
            overflow-y: auto;
        }

        /* Mobile Responsiveness */
        @media screen and (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: 70px 60px 1fr;
            }

            .header {
                padding: 0 15px;
            }

            .logo {
                font-size: 18px;
            }

            .user-menu {
                font-size: 14px;
            }

            .user-avatar {
                width: 32px;
                height: 32px;
            }

            .sidebar {
                grid-row: 2 / 3;
                grid-column: 1 / -1;
                display: grid;
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                overflow: hidden;
                border-right: none;
                border-bottom: 1px solid #e1e1e1;
                height: 60px;
            }

            .sidebar-header, .conversation-list {
                display: none;
            }

            .tabs {
                padding: 5px 15px;
                border-bottom: none;
            }

            .chat-area {
                grid-row: 3 / 4;
                grid-column: 1 / -1;
            }

            .chat-header {
                padding: 10px 15px;
            }

            .chat-title img {
                width: 32px;
                height: 32px;
                margin-right: 10px;
            }

            .chat-title-text h2 {
                font-size: 16px;
            }

            .chat-title-text p {
                font-size: 12px;
            }

            .chat-actions button {
                font-size: 16px;
                margin-left: 10px;
            }

            .chat-messages {
                padding: 15px;
            }

            .message {
                max-width: 85%;
            }

            .chat-input {
                padding: 10px 15px;
            }

            .chat-input button {
                font-size: 16px;
                margin-right: 10px;
            }

            .chat-input .send-btn {
                width: 36px;
                height: 36px;
            }

            .welcome-container {
                padding: 15px;
            }

            .welcome-icon {
                font-size: 60px;
            }

            .welcome-title {
                font-size: 20px;
            }

            .welcome-subtitle {
                font-size: 14px;
                margin-bottom: 20px;
            }

            .welcome-features {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            /* Show sidebar when active */
            .show-sidebar .sidebar {
                height: auto;
                grid-row: 2 / 4;
                z-index: 50;
                background-color: white;
            }

            .show-sidebar .sidebar-header,
            .show-sidebar .conversation-list {
                display: block;
            }

            .show-sidebar .chat-area {
                display: none;
            }

            /* Back button for mobile */
            .mobile-back-btn {
                display: none;
                background: none;
                border: none;
                color: #667eea;
                font-size: 18px;
                margin-right: 10px;
                cursor: pointer;
            }

            .show-chat .mobile-back-btn {
                display: block;
            }

            /* Mobile navigation buttons */
            .mobile-nav {
                display: none;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background-color: white;
                border-top: 1px solid #e1e1e1;
                padding: 10px;
                display: flex;
                justify-content: space-around;
                z-index: 100;
            }

            .mobile-nav button {
                background: none;
                border: none;
                color: #6c757d;
                font-size: 18px;
                padding: 8px 15px;
                border-radius: 5px;
                cursor: pointer;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .mobile-nav button.active {
                color: #667eea;
                background-color: #f5f7fb;
            }

            .mobile-nav button span {
                font-size: 12px;
                margin-top: 5px;
            }

            /* Admin panel adjustments */
            .admin-panel {
                width: 100%;
            }
        }

        /* Small phones */
        @media screen and (max-width: 480px) {
            .header {
                padding: 0 10px;
            }

            .logo {
                font-size: 16px;
            }

            .user-avatar {
                width: 28px;
                height: 28px;
                margin-right: 5px;
            }

            #username {
                max-width: 80px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .chat-title-text h2 {
                font-size: 15px;
            }

            .chat-input button {
                margin-right: 8px;
            }

            .chat-input input {
                padding: 10px;
            }

            .message {
                max-width: 90%;
            }

            .welcome-features {
                width: 100%;
            }

            .admin-panel-header h2 {
                font-size: 16px;
            }

            .admin-section h3 {
                font-size: 15px;
            }

            .mobile-nav button {
                font-size: 16px;
                padding: 5px 10px;
            }

        }

        /* Encryption Styles */
        .encryption-status {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background-color: #f0f4f9;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #3c4858;
            border-left: 3px solid #4CAF50;
        }

        .encryption-status i {
            color: #4CAF50;
            margin-right: 8px;
            font-size: 16px;
        }

        .encryption-status.disabled {
            border-left-color: #e74c3c;
        }

        .encryption-status.disabled i {
            color: #e74c3c;
        }

        /* Specific styles for encryption status in messages */
        .message-encryption {
            padding: 4px 8px;
            font-size: 12px;
            margin-top: 8px;
            margin-bottom: 0;
            border-left-width: 2px;
        }

        .message-encryption i {
            font-size: 12px;
        }

        .message-encryption.decrypt-failed {
            border-left-color: #e74c3c;
            background-color: #fff5f5;
        }

        .message-encryption.decrypt-failed i {
            color: #e74c3c;
        }

        .key-fingerprint {
            margin-left: auto;
            color: #6c757d;
            font-size: 12px;
            letter-spacing: 1px;
            max-width: 160px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .encryption-toggle {
            margin-top: 10px;
            display: flex;
            align-items: center;
        }

        .encryption-toggle-label {
            margin-right: 10px;
            font-weight: 500;
            flex-grow: 1;
        }

        /* Encryption Key Management */
        .key-management {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin-top: 15px;
        }

        .key-management h4 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
            display: flex;
            align-items: center;
        }

        .key-management h4 i {
            margin-right: 8px;
            color: #667eea;
        }

        .key-info {
            background-color: #fff;
            border: 1px solid #e1e1e1;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            max-height: 100px;
            overflow-y: auto;
        }

        .key-actions {
            display: flex;
            gap: 10px;
        }

        .key-actions button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 5px;
            background-color: #667eea;
            color: white;
            font-size: 14px;
            cursor: pointer;
        }

        .key-actions button.danger {
            background-color: #e74c3c;
        }

        .key-actions button:hover {
            opacity: 0.9;
        }

        /* Search Box Styles */
        .search-container {
            margin-bottom: 15px;
        }

        .search-results {
            display: none;
            position: absolute;
            top: 70px; /* Adjust based on header height */
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid #e1e1e1;
            z-index: 100;
            max-height: 300px;
            overflow-y: auto;
        }

        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #e1e1e1;
        }

        .search-results-container {
            padding: 10px;
        }

        .search-pagination {
            display: flex;
            justify-content: space-between;
            padding: 10px;
        }

        .search-pagination button {
            background-color: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
        }

        .search-pagination button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-comments"></i>
                Enhanced Chat
            </div>
            <div class="user-menu">
                <div class="user-status">
                    <img src="/uploads/default-avatar.png" alt="User" class="user-avatar" id="user-avatar">
                    <span class="status-indicator"></span>
                </div>
                <span id="username">Loading...</span>
                <div class="user-dropdown">
                    <button class="dropdown-btn" id="user-menu-btn">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <!-- Dropdown menu will be added via JS -->
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search" id="search-input">
                </div>

                <!-- Message Search Box -->
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="Search messages...">
                        <button id="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <!-- Translation Settings Section -->
                <div class="translation-settings">
                    <h3><i class="fas fa-language"></i> Translation Settings</h3>
                    <div class="setting-row">
                        <div class="setting-label">Auto-translate messages</div>
                        <label class="switch">
                            <input type="checkbox" id="auto-translate-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">Preferred language</div>
                        <select id="translation-language" class="language-dropdown">
                            <option value="en">English</option>
                            <!-- Other languages will be loaded dynamically -->
                        </select>
                    </div>
                </div>

                <!-- Encryption Settings Section -->
                <div class="translation-settings"> <!-- reusing the same CSS class for consistency -->
                    <h3><i class="fas fa-lock"></i> End-to-End Encryption</h3>
                    <div class="setting-row">
                        <div class="setting-label">Enable encryption</div>
                        <label class="switch">
                            <input type="checkbox" id="encryption-toggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="key-management">
                        <h4><i class="fas fa-key"></i> Your Encryption Key</h4>
                        <div class="key-info" id="key-fingerprint">Loading key information...</div>
                        <div class="key-actions">
                            <button id="regenerate-key-btn" title="Generate a new encryption key">
                                <i class="fas fa-sync"></i> Regenerate
                            </button>
                            <button id="export-key-btn" title="Export your encryption keys">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tabs">
                <div class="tab active" data-tab="chats">Chats</div>
                <div class="tab" data-tab="groups">Groups</div>
            </div>
            <div class="conversation-list" id="conversation-list">
                <!-- Conversations will be loaded dynamically -->
                <div class="conversation">
                    <img src="/uploads/default-avatar.png" alt="User" class="conversation-avatar">
                    <div class="conversation-status status-online"></div>
                    <div class="conversation-details">
                        <div class="conversation-name">Loading conversations...</div>
                        <div class="conversation-message">Please wait</div>
                    </div>
                </div>
            </div>

            <!-- Add this after the conversation-list div in the sidebar section -->
            <div id="groups-section" class="chat-section hidden">
                <div class="groups-header">
                    <h2>Your Groups</h2>
                    <button id="create-group-btn" class="btn-secondary">
                        <i class="fas fa-plus"></i> New Group
                    </button>
                </div>
                <div id="groups-list" class="groups-list"></div>
            </div>
        </aside>

        <!-- Chat Area -->
        <main class="chat-area" id="chat-area">
            <!-- Add mobile back button -->
            <button class="mobile-back-btn" id="mobile-back-btn">
                <i class="fas fa-arrow-left"></i>
            </button>

            <!-- Welcome message shown when no chat is selected -->
            <div class="welcome-container" id="welcome-container">
                <div class="welcome-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <h1 class="welcome-title">Welcome to Enhanced Chat</h1>
                <p class="welcome-subtitle">Select a conversation to start messaging or create a new group chat</p>

                <div class="welcome-features">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="feature-title">Private Messaging</div>
                        <div class="feature-desc">Send private messages to any user</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="feature-title">Group Chats</div>
                        <div class="feature-desc">Create groups for team discussions</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-file-upload"></i>
                        </div>
                        <div class="feature-title">File Sharing</div>
                        <div class="feature-desc">Share documents and images</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="feature-title">Message Search</div>
                        <div class="feature-desc">Find past conversations easily</div>
                    </div>
                </div>
            </div>

            <!-- Chat interface (hidden by default, shown when chat is selected) -->
            <div id="chat-interface" style="display: none; height: 100%; display: flex; flex-direction: column;">
                <div class="chat-header">
                    <div class="chat-title">
                        <img src="/uploads/default-avatar.png" alt="Recipient" id="chat-recipient-avatar">
                        <div class="chat-title-text">
                            <h2 id="chat-recipient-name">User Name</h2>
                            <p id="chat-recipient-status">Online</p>
                        </div>
                    </div>

                    <!-- Add encryption status -->
                    <div class="encryption-status" id="encryption-status">
                        <i class="fas fa-lock"></i>
                        <span>End-to-end encrypted</span>
                        <div class="key-fingerprint" id="chat-key-fingerprint">Loading...</div>
                    </div>

                    <div class="chat-actions">
                        <button><i class="fas fa-search"></i></button>
                        <button><i class="fas fa-phone"></i></button>
                        <button><i class="fas fa-video"></i></button>
                        <button><i class="fas fa-info-circle"></i></button>
                    </div>
                </div>

                <div class="chat-messages" id="messages-container">
                    <!-- Messages will be loaded dynamically -->
                </div>

                <div class="chat-input">
                    <button><i class="fas fa-paperclip"></i></button>
                    <button><i class="far fa-smile"></i></button>
                    <input type="text" placeholder="Type a message..." id="message-input">
                    <div class="send-btn" id="send-btn">
                        <i class="fas fa-paper-plane"></i>
                    </div>
                </div>

                <!-- Translation UI -->
                <div class="message-translation" id="message-translation" style="display: none;">
                    <div class="translation-header">Translation:</div>
                    <div class="translation-text" id="translation-text"></div>
                    <div class="translation-loading" id="translation-loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i> Translating...
                    </div>
                    <div class="message-actions">
                        <button class="translate-message-btn" id="translate-message-btn">Translate</button>
                    </div>
                </div>
            </div>

            <!-- Group chat area -->
            <div id="group-chat" class="chat-section hidden">
                <div class="chat-header">
                    <div class="group-info">
                        <img id="group-avatar" src="/uploads/default-group.png" alt="Group" class="profile-picture-small">
                        <h2 id="group-name-display">Group Name</h2>
                    </div>
                    <button id="group-info-btn" class="btn-secondary">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </div>
                <div id="group-messages" class="message-container"></div>
                <div id="typing-indicator-group" class="typing-indicator hidden">
                    <span class="typing-user"></span> is typing...
                </div>
                <div class="message-input-container">
                    <div class="message-attachments" id="group-attachments"></div>
                    <div class="message-input">
                        <button id="group-emoji-btn" class="emoji-btn">
                            <i class="far fa-smile"></i>
                        </button>
                        <input type="text" id="group-message-input" placeholder="Type a message...">
                        <button id="group-attachment-btn" class="attachment-btn">
                            <i class="fas fa-paperclip"></i>
                            <input type="file" id="group-attachment-input" hidden>
                        </button>
                        <button id="send-group-btn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Add Group Creation Modal -->
            <div id="create-group-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <h2>Create New Group</h2>
                    <form id="create-group-form">
                        <div class="form-group">
                            <label for="group-name">Group Name</label>
                            <input type="text" id="group-name" required>
                        </div>
                        <div class="form-group">
                            <label for="group-description">Description</label>
                            <textarea id="group-description"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Privacy</label>
                            <div class="radio-group">
                                <input type="radio" id="group-public" name="privacy" value="public" checked>
                                <label for="group-public">Public</label>
                                <input type="radio" id="group-private" name="privacy" value="private">
                                <label for="group-private">Private</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Add Members</label>
                            <div id="group-members-selection" class="group-members-selection"></div>
                        </div>
                        <button type="submit" class="btn-primary">Create Group</button>
                    </form>
                </div>
            </div>
        </main>

        <!-- Search Results Panel -->
        <div id="search-results" class="search-results hidden">
            <div class="search-header">
                <h3>Search Results</h3>
                <button class="close-search">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="search-results-container" class="search-results-container"></div>
            <div class="search-pagination">
                <button id="prev-page" class="btn-secondary" disabled>Previous</button>
                <span id="page-info">Page 1</span>
                <button id="next-page" class="btn-secondary">Next</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel (hidden by default) -->
    <div class="admin-panel" id="admin-panel">
        <div class="admin-panel-header">
            <h2>Admin Panel</h2>
            <button id="close-admin-panel"><i class="fas fa-times"></i></button>
        </div>

        <div class="admin-section">
            <h3>System Overview</h3>
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-users">0</div>
                    <div class="stat-label">Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="active-users">0</div>
                    <div class="stat-label">Online</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-messages">0</div>
                    <div class="stat-label">Messages</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-groups">0</div>
                    <div class="stat-label">Groups</div>
                </div>
            </div>
        </div>

        <div class="admin-section">
            <h3>User Management</h3>
            <div class="admin-filters">
                <select id="user-filter" class="admin-select">
                    <option value="all">All Users</option>
                    <option value="online">Online</option>
                    <option value="offline">Offline</option>
                    <option value="admins">Admins</option>
                </select>
                <div class="search-box" style="margin-top: 10px;">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search users" id="user-search">
                </div>
            </div>
            <div class="user-list" id="admin-user-list">
                <!-- User list will be populated via JS -->
                <div class="loading-message">Loading users...</div>
            </div>
            <button class="admin-action-btn" id="create-user-btn">
                <i class="fas fa-user-plus"></i> Create New User
            </button>
        </div>

        <div class="admin-section">
            <h3>Content Moderation</h3>
            <div class="admin-filters">
                <select id="content-filter" class="admin-select">
                    <option value="all">All Content</option>
                    <option value="flagged">Flagged Content</option>
                    <option value="reported">Reported Messages</option>
                </select>
                <div class="search-box" style="margin-top: 10px;">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search content" id="content-search">
                </div>
            </div>
            <div class="content-list" id="content-list">
                <!-- Content will be populated via JS -->
                <div class="loading-message">Loading content...</div>
            </div>
        </div>

        <div class="admin-section">
            <h3>System Settings</h3>
            <div class="settings-list">
                <div class="setting-item">
                    <div class="setting-label">Auto-moderate offensive content</div>
                    <label class="switch">
                        <input type="checkbox" id="auto-moderate-toggle" checked>
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div class="setting-label">Email notifications for reported content</div>
                    <label class="switch">
                        <input type="checkbox" id="email-notifications-toggle" checked>
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div class="setting-label">Maximum file upload size</div>
                    <select class="admin-select" id="max-upload-size">
                        <option value="5">5 MB</option>
                        <option value="10" selected>10 MB</option>
                        <option value="20">20 MB</option>
                        <option value="50">50 MB</option>
                    </select>
                </div>
                <div class="setting-item">
                    <div class="setting-label">User inactivity timeout</div>
                    <select class="admin-select" id="inactivity-timeout">
                        <option value="5">5 minutes</option>
                        <option value="10" selected>10 minutes</option>
                        <option value="30">30 minutes</option>
                        <option value="60">1 hour</option>
                    </select>
                </div>
            </div>
            <button class="admin-action-btn" id="save-settings-btn">
                <i class="fas fa-save"></i> Save Settings
            </button>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="mobile-nav">
        <button id="chats-nav" class="active">
            <i class="fas fa-comments"></i>
            <span>Chats</span>
        </button>
        <button id="groups-nav">
            <i class="fas fa-users"></i>
            <span>Groups</span>
        </button>
        <button id="search-nav">
            <i class="fas fa-search"></i>
            <span>Search</span>
        </button>
        <button id="profile-nav">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </button>
    </div>

    <!-- User Management Modal -->
    <div class="modal" id="user-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="user-modal-title">Manage User</h3>
                <button class="close-btn" id="close-user-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="user-form">
                    <div class="form-group">
                        <label for="user-username">Username</label>
                        <input type="text" id="user-username" required>
                    </div>
                    <div class="form-group">
                        <label for="user-email">Email</label>
                        <input type="email" id="user-email" required>
                    </div>
                    <div class="form-group">
                        <label for="user-password">Password (leave blank to keep unchanged)</label>
                        <input type="password" id="user-password">
                    </div>
                    <div class="form-group">
                        <label for="user-status">Status</label>
                        <select id="user-status">
                            <option value="online">Online</option>
                            <option value="away">Away</option>
                            <option value="busy">Busy</option>
                            <option value="offline">Offline</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="user-admin">
                            Admin privileges
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="user-notes">Admin notes</label>
                        <textarea id="user-notes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="delete-btn" id="delete-user-btn" type="button">Delete User</button>
                <button class="submit-btn" id="save-user-btn" type="button">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Content Moderation Modal -->
    <div class="modal" id="content-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="content-modal-title">Moderate Content</h3>
                <button class="close-btn" id="close-content-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="content-details">
                    <div class="content-item">
                        <div class="content-label">Content ID:</div>
                        <div class="content-value" id="content-id"></div>
                    </div>
                    <div class="content-item">
                        <div class="content-label">Sender:</div>
                        <div class="content-value" id="content-sender"></div>
                    </div>
                    <div class="content-item">
                        <div class="content-label">Date & Time:</div>
                        <div class="content-value" id="content-datetime"></div>
                    </div>
                    <div class="content-item">
                        <div class="content-label">Type:</div>
                        <div class="content-value" id="content-type"></div>
                    </div>
                </div>

                <div class="content-message" id="content-message"></div>

                <div class="content-actions">
                    <div class="form-group">
                        <label for="moderation-action">Action</label>
                        <select id="moderation-action">
                            <option value="approve">Approve Content</option>
                            <option value="remove">Remove Content</option>
                            <option value="warn">Warn User</option>
                            <option value="restrict">Restrict User</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="moderation-notes">Moderation notes</label>
                        <textarea id="moderation-notes" rows="3"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn" id="cancel-moderation-btn" type="button">Cancel</button>
                <button class="submit-btn" id="apply-moderation-btn" type="button">Apply Action</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="js/util.js"></script>
    <script src="js/auth.js"></script>
    <!-- Add our feature modules -->
    <script src="js/message-cache.js"></script>
    <script src="js/offline-handler.js"></script>
    <script src="js/message-reactions.js"></script>
    <script src="js/message-delivery.js"></script>
    <script src="js/voice-messages.js"></script>
    <script src="js/message-threading.js"></script>
    <!-- Add new advanced feature modules -->
    <script src="js/message-quoting.js"></script>
    <script src="js/message-sharing.js"></script>
    <script src="js/thread-summarizer.js"></script>
    <script src="js/threads-tab.js"></script>
    <script src="js/message-bookmarks.js"></script>
    <script src="js/message-labels.js"></script>
    <script src="js/rich-text-editor.js"></script>
    <script src="js/attachment-viewer.js"></script>
    <script src="js/typing-indicator.js"></script>
    <script src="js/message-scheduler.js"></script>
    <!-- Main script should come last to use all the modules -->
    <script src="js/main.js"></script>
    <script type="module">
        import { initAdminFeatures, loadAdminData } from './js/admin.js';
        import { initTranslation } from './js/translation.js';
        import { initEncryption, getPublicKey, getEncryptionStatusHTML } from './js/encryption.js';

        document.addEventListener('DOMContentLoaded', async function() {
            // Check if user is logged in
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');

            if (!userData || !userData.token) {
                // Redirect to login page if not logged in
                window.location.href = '/login.html';
                return;
            }

            // Update user info in the header
            document.getElementById('username').textContent = userData.username;
            if (userData.profilePicture) {
                document.getElementById('user-avatar').src = userData.profilePicture;
            }

            // Initialize socket connection for translation and encryption
            const socket = io();

            // Initialize translation features
            initTranslation(socket);

            // Initialize encryption
            await initEncryption();

            // If user hasn't uploaded their public key yet, do it now
            if (!userData.publicKey) {
                const publicKey = await getPublicKey();

                // Update the user's public key on the server
                try {
                    const response = await fetch('/api/users/public-key', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${userData.token}`
                        },
                        body: JSON.stringify({ publicKey })
                    });

                    if (response.ok) {
                        // Update local storage
                        userData.publicKey = publicKey;
                        localStorage.setItem('userData', JSON.stringify(userData));

                        // Update UI
                        updateKeyDisplay(publicKey);
                    }
                } catch (error) {
                    console.error('Failed to update public key:', error);
                }
            } else {
                // If we already have a public key, just update the UI
                updateKeyDisplay(userData.publicKey);
            }

            // Update encryption UI elements
            document.getElementById('encryption-toggle').checked =
                userData.encryptionEnabled !== false; // Default to true if not set

            document.getElementById('encryption-toggle').addEventListener('change', async function(e) {
                const enabled = e.target.checked;

                try {
                    const response = await fetch('/api/users/encryption', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${userData.token}`
                        },
                        body: JSON.stringify({ enabled })
                    });

                    if (response.ok) {
                        // Update local storage
                        userData.encryptionEnabled = enabled;
                        localStorage.setItem('userData', JSON.stringify(userData));

                        // Show notification
                        const message = enabled ? 'Encryption enabled' : 'Encryption disabled';
                        showToast(message, enabled ? 'success' : 'warning');
                    }
                } catch (error) {
                    console.error('Failed to update encryption setting:', error);
                    showToast('Failed to update encryption setting', 'error');
                }
            });

            // Key management buttons
            document.getElementById('regenerate-key-btn').addEventListener('click', async function() {
                if (confirm('Are you sure you want to regenerate your encryption key? You will no longer be able to decrypt previous messages.')) {
                    // Clear previous key and generate a new one
                    localStorage.removeItem('encryptionKeyPair');
                    await initEncryption();

                    // Get the new public key
                    const publicKey = await getPublicKey();

                    // Update on server
                    try {
                        const response = await fetch('/api/users/public-key', {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${userData.token}`
                            },
                            body: JSON.stringify({ publicKey })
                        });

                        if (response.ok) {
                            // Update local storage
                            userData.publicKey = publicKey;
                            localStorage.setItem('userData', JSON.stringify(userData));

                            // Update UI
                            updateKeyDisplay(publicKey);
                            showToast('Encryption key regenerated successfully', 'success');
                        }
                    } catch (error) {
                        console.error('Failed to update public key:', error);
                        showToast('Failed to update encryption key', 'error');
                    }
                }
            });

            document.getElementById('export-key-btn').addEventListener('click', function() {
                // Export the key pair as a JSON file
                const keyPair = localStorage.getItem('encryptionKeyPair');
                if (!keyPair) {
                    showToast('No encryption key to export', 'error');
                    return;
                }

                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(keyPair);
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "chat-encryption-key.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            });

            // Helper function to update key display
            function updateKeyDisplay(publicKey) {
                getEncryptionStatusHTML(publicKey).then(html => {
                    const fingerprintEl = document.getElementById('key-fingerprint');
                    if (fingerprintEl) {
                        fingerprintEl.innerHTML = html;
                    }
                });
            }

            // Show toast notification
            function showToast(message, type = 'info') {
                // Create or get toast container
                let toastContainer = document.getElementById('toast-container');

                if (!toastContainer) {
                    toastContainer = document.createElement('div');
                    toastContainer.id = 'toast-container';
                    document.body.appendChild(toastContainer);
                }

                // Create toast
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                toastContainer.appendChild(toast);

                // Remove after animation completes
                setTimeout(() => {
                    toast.remove();
                }, 3500);
            }

            // ... existing initialization code ...
        });
    </script>
</body>
</html>
